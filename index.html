<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æˆ‘çš„ç§äººä¿é™©ç®±</title>
<style>
    /* æ·±è‰²æ¨¡å¼é£æ ¼ï¼Œçœ‹èµ·æ¥æ›´ç§å¯† */
    body { font-family: -apple-system, sans-serif; background-color: #1a1a1a; color: #fff; margin: 0; padding: 0; height: 100vh; overflow: hidden; }
    
    /* === ç™»å½•å±‚ === */
    #login-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .lock-icon { font-size: 50px; margin-bottom: 20px; }
    .pin-input { font-size: 24px; padding: 10px; text-align: center; border-radius: 10px; border: 1px solid #333; background: #222; color: white; width: 200px; letter-spacing: 5px; outline: none; }
    .btn-unlock { margin-top: 20px; padding: 12px 40px; border-radius: 25px; background: #007aff; color: white; border: none; font-size: 16px; font-weight: bold; cursor: pointer; }
    
    /* === å†…å®¹å±‚ === */
    #app-layer { padding: 20px; height: 100%; overflow-y: auto; display: none; padding-bottom: 100px; box-sizing: border-box; }
    
    /* æ·»åŠ æŒ‰é’® */
    .fab-add { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: #007aff; border-radius: 50%; color: white; font-size: 30px; border: none; box-shadow: 0 4px 15px rgba(0,122,255,0.4); cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 100; }
    
    /* å¡ç‰‡æ ·å¼ */
    .card { background: #2c2c2e; border-radius: 12px; padding: 15px; margin-bottom: 15px; position: relative; border-left: 4px solid #007aff; }
    .card-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; display: flex; justify-content: space-between; }
    .card-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 14px; color: #aaa; }
    .card-val { color: #fff; font-family: monospace; font-size: 16px; margin-right: 10px; }
    .btn-copy { background: #3a3a3c; color: #fff; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; }
    .btn-eye { background: none; border: none; font-size: 16px; cursor: pointer; margin-left: 5px; }
    .delete-card { color: #ff453a; font-size: 12px; background: none; border: 1px solid #ff453a; padding: 2px 6px; border-radius: 4px; cursor: pointer;}

    /* æ·»åŠ è¡¨å•æ¨¡æ€æ¡† */
    #modal-add { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 200; display: none; justify-content: center; align-items: center; }
    .modal-content { background: #2c2c2e; width: 85%; padding: 20px; border-radius: 15px; }
    .input-field { width: 100%; padding: 12px; margin: 10px 0; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 8px; box-sizing: border-box; font-size: 16px;}
    .modal-btns { display: flex; gap: 10px; margin-top: 10px; }
    .btn-save { flex: 1; padding: 12px; background: #30d158; color: white; border: none; border-radius: 8px; font-weight: bold; }
    .btn-cancel { flex: 1; padding: 12px; background: #3a3a3c; color: white; border: none; border-radius: 8px; }

    /* æç¤ºæ¡ */
    #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.9); color: black; padding: 10px 20px; border-radius: 20px; opacity: 0; transition: 0.3s; z-index: 1000; pointer-events: none; font-weight: bold; }
</style>
</head>
<body>

<div id="toast">å·²å¤åˆ¶</div>

<!-- 1. ç™»å½•/è§£é”ç•Œé¢ -->
<div id="login-layer">
    <div class="lock-icon">ğŸ”’</div>
    <h3 id="lock-msg">è¯·è¾“å…¥è§£é”å¯†ç </h3>
    <input type="password" id="pin-input" class="pin-input" maxlength="6" inputmode="numeric" placeholder="******">
    <button class="btn-unlock" onclick="checkPin()">è§£é”è¿›å…¥</button>
    <div style="margin-top:20px; color:#555; font-size:12px;" id="first-run-hint"></div>
</div>

<!-- 2. ä¸»ç•Œé¢ -->
<div id="app-layer">
    <h2 style="margin-top:10px;">æˆ‘çš„è´¦å·åº“</h2>
    <div id="card-list">
        <!-- å¡ç‰‡ä¼šåœ¨è¿™é‡Œç”Ÿæˆ -->
    </div>
</div>

<!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
<button class="fab-add" onclick="showModal()">+</button>

<!-- 3. æ·»åŠ è´¦å·çš„å¼¹çª— -->
<div id="modal-add">
    <div class="modal-content">
        <h3>æ–°å¢è´¦å·</h3>
        <input type="text" id="in-title" class="input-field" placeholder="åç§° (å¦‚: å·¥è¡Œå‚¨è“„å¡)">
        <input type="text" id="in-acc" class="input-field" placeholder="è´¦å·/å¡å·">
        <input type="text" id="in-pwd" class="input-field" placeholder="å¯†ç  (æˆ–æç¤º)">
        <div class="modal-btns">
            <button class="btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="btn-save" onclick="saveNewItem()">ä¿å­˜</button>
        </div>
    </div>
</div>

<script>
    // === æ ¸å¿ƒé€»è¾‘ ===
    const STORE_KEY = 'my_secret_vault_v1';
    const PIN_KEY = 'my_secret_pin';
    let userPin = localStorage.getItem(PIN_KEY);
    let vaultData = JSON.parse(localStorage.getItem(STORE_KEY)) || [];

    // åˆå§‹åŒ–æ£€æŸ¥
    window.onload = function() {
        if (!userPin) {
            document.getElementById('lock-msg').innerText = "ğŸ†• è®¾ç½®æ–°å¯†ç  (è¯·ç‰¢è®°!)";
            document.getElementById('first-run-hint').innerText = "é¦–æ¬¡ä½¿ç”¨ï¼Œè¯·è®¾ç½®ä½ çš„è¿›å…¥å¯†ç ";
        }
    }

    // 1. è§£é”/è®¾ç½®å¯†ç é€»è¾‘
    function checkPin() {
        const input = document.getElementById('pin-input').value;
        if (!input) return;

        if (!userPin) {
            // ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œè®¾ç½®å¯†ç 
            userPin = input;
            localStorage.setItem(PIN_KEY, userPin);
            alert("å¯†ç è®¾ç½®æˆåŠŸï¼ä¸‹æ¬¡è¯·ä½¿ç”¨æ­¤å¯†ç è§£é”ã€‚");
            unlockApp();
        } else {
            // éªŒè¯å¯†ç 
            if (input === userPin) {
                unlockApp();
            } else {
                alert("å¯†ç é”™è¯¯ï¼");
                document.getElementById('pin-input').value = '';
            }
        }
    }

    function unlockApp() {
        document.getElementById('login-layer').style.display = 'none';
        document.getElementById('app-layer').style.display = 'block';
        renderList();
    }

    // 2. æ¸²æŸ“åˆ—è¡¨
    function renderList() {
        const container = document.getElementById('card-list');
        container.innerHTML = '';
        
        vaultData.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-title">
                    ${item.title}
                    <button class="delete-card" onclick="deleteItem(${index})">åˆ é™¤</button>
                </div>
                <div class="card-row">
                    <span>è´¦å·:</span>
                    <div>
                        <span class="card-val">${item.acc}</span>
                        <button class="btn-copy" onclick="copyText('${item.acc}')">å¤åˆ¶</button>
                    </div>
                </div>
                <div class="card-row">
                    <span>å¯†ç :</span>
                    <div style="display:flex; align-items:center;">
                        <span class="card-val" id="pwd-${index}">â€¢â€¢â€¢â€¢â€¢â€¢</span>
                        <button class="btn-eye" onclick="togglePwd(${index}, '${item.pwd}')">ğŸ‘ï¸</button>
                        <button class="btn-copy" onclick="copyText('${item.pwd}')">å¤åˆ¶</button>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    // 3. äº¤äº’åŠŸèƒ½ï¼šæ˜¾ç¤º/éšè—å¯†ç 
    function togglePwd(index, realPwd) {
        const span = document.getElementById(`pwd-${index}`);
        if (span.innerText === 'â€¢â€¢â€¢â€¢â€¢â€¢') {
            span.innerText = realPwd;
        } else {
            span.innerText = 'â€¢â€¢â€¢â€¢â€¢â€¢';
        }
    }

    // 4. äº¤äº’åŠŸèƒ½ï¼šå¤åˆ¶
    function copyText(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        
        // æ˜¾ç¤ºæç¤º
        const toast = document.getElementById('toast');
        toast.style.opacity = 1;
        setTimeout(() => toast.style.opacity = 0, 1500);
    }

    // 5. æ•°æ®ç®¡ç†ï¼šæ–°å¢
    function showModal() { document.getElementById('modal-add').style.display = 'flex'; }
    function closeModal() { document.getElementById('modal-add').style.display = 'none'; }

    function saveNewItem() {
        const title = document.getElementById('in-title').value;
        const acc = document.getElementById('in-acc').value;
        const pwd = document.getElementById('in-pwd').value;

        if (!title) { alert("è‡³å°‘å†™ä¸ªåç§°å§"); return; }

        vaultData.push({ title, acc, pwd });
        localStorage.setItem(STORE_KEY, JSON.stringify(vaultData));
        
        // æ¸…ç©ºè¡¨å•
        document.getElementById('in-title').value = '';
        document.getElementById('in-acc').value = '';
        document.getElementById('in-pwd').value = '';
        
        closeModal();
        renderList();
    }

    // 6. æ•°æ®ç®¡ç†ï¼šåˆ é™¤
    function deleteItem(index) {
        if(confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ")) {
            vaultData.splice(index, 1);
            localStorage.setItem(STORE_KEY, JSON.stringify(vaultData));
            renderList();
        }
    }
</script>
</body>
</html>