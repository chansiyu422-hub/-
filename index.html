<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æˆ‘çš„å¤šå½©å¡åŒ…</title>
<!-- å¼•å…¥ OCR å¼•æ“ -->
<script src='https://unpkg.com/tesseract.js@4.0.2/dist/tesseract.min.js'></script>
<style>
    :root {
        --bg-color: #f2f6f9; /* æµ…ç°ç™½èƒŒæ™¯ */
        --text-dark: #333333;
        --text-gray: #888888;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif; /* æ¢å¤é»˜è®¤å­—ä½“ */
        background-color: var(--bg-color);
        color: var(--text-dark);
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
    }

    /* === 1. ç™»å½•å±‚ï¼šæ¸…æ–°ç®€çº¦é£ === */
    #login-layer {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #ffffff;
        z-index: 999;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
    }
    
    .lock-emoji { font-size: 80px; margin-bottom: 20px; animation: bounce 2s infinite; }
    @keyframes bounce { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-10px);} }

    .pin-title { font-size: 20px; color: #333; margin-bottom: 30px; font-weight: bold; }

    .pin-input {
        font-size: 28px; padding: 15px; text-align: center;
        border-radius: 20px;
        border: none;
        background: #f0f2f5;
        color: #333;
        width: 200px; letter-spacing: 8px; outline: none;
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
    }

    .btn-unlock {
        margin-top: 40px; padding: 15px 80px; border-radius: 40px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white; border: none; font-size: 18px; font-weight: bold; cursor: pointer;
        box-shadow: 0 10px 20px rgba(118, 75, 162, 0.3);
        transition: transform 0.1s;
    }
    .btn-unlock:active { transform: scale(0.95); }

    /* === 2. ä¸»ç•Œé¢ === */
    #app-layer {
        padding: 20px; height: 100%; overflow-y: auto; display: none;
        padding-bottom: 120px; box-sizing: border-box;
    }

    .main-title {
        font-size: 28px; font-weight: 800; color: #333;
        margin-top: 10px; margin-bottom: 25px;
        display: flex; align-items: center; justify-content: space-between;
    }

    /* === 3. å¤šå½©å¡ç‰‡è®¾è®¡ (è¿˜åŸå›¾ç‰‡é£æ ¼) === */
    .card {
        border-radius: 24px;
        padding: 20px;
        margin-bottom: 20px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 10px 25px rgba(0,0,0,0.08);
        transition: transform 0.2s;
    }
    .card:active { transform: scale(0.98); }

    /* è£…é¥°æ€§çš„å°åœ†çƒ */
    .bubble {
        position: absolute; border-radius: 50%; opacity: 0.6;
    }

    /* å››ç§é¢œè‰²ä¸»é¢˜ */
    /* 1. è–„è·ç»¿ (åƒå›¾ä¸­çš„ Facebook å¡ç‰‡) */
    .theme-1 { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
    .theme-1 .bubble { background: #fff; opacity: 0.2; }
    
    /* 2. é¦™èŠ‹ç´« (åƒå›¾ä¸­çš„ Password å¡ç‰‡) */
    .theme-2 { background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); }
    .theme-2 .bubble { background: #fff; opacity: 0.2; }

    /* 3. å¤©ç©ºè“ (åƒå›¾ä¸­çš„ Cloud Storage å¡ç‰‡) */
    .theme-3 { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
    .theme-3 .bubble { background: #fff; opacity: 0.2; }

    /* 4. æš–é˜³æ©™ (åƒå›¾ä¸­çš„ Passwordrice å¡ç‰‡) */
    .theme-4 { background: linear-gradient(135deg, #fccb90 0%, #d57eeb 100%); }
    .theme-4 .bubble { background: #fff; opacity: 0.2; }

    /* å¡ç‰‡æ ‡é¢˜åŒº */
    .card-header {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 15px; position: relative; z-index: 2;
    }
    .card-icon {
        width: 40px; height: 40px; background: rgba(255,255,255,0.9);
        border-radius: 50%; display: flex; align-items: center; justify-content: center;
        font-weight: bold; font-size: 18px; color: #555;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .card-name {
        font-size: 18px; font-weight: bold; color: white;
        text-shadow: 0 1px 2px rgba(0,0,0,0.1); flex: 1; margin-left: 15px;
    }
    .btn-delete {
        background: rgba(255,255,255,0.3); border: none; color: white;
        width: 30px; height: 30px; border-radius: 50%; font-size: 12px; cursor: pointer;
    }

    /* ç™½è‰²å†…å®¹æ¡† (å›¾ä¸­çš„ç™½è‰²åŒºåŸŸ) */
    .card-content-box {
        background: #ffffff;
        border-radius: 16px;
        padding: 15px;
        position: relative; z-index: 2;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    .info-item { margin-bottom: 12px; }
    .info-label { font-size: 12px; color: #999; margin-bottom: 4px; }
    .info-value-row { display: flex; justify-content: space-between; align-items: center; }
    .info-value {
        font-size: 16px; color: #333; font-weight: 500;
        overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80%;
    }
    
    /* å°èƒ¶å›ŠæŒ‰é’® */
    .capsule-btn {
        background: #f0f2f5; color: #666; padding: 4px 10px;
        border-radius: 20px; font-size: 12px; border: none; cursor: pointer; font-weight: bold;
    }
    
    /* === æ‚¬æµ®æ·»åŠ æŒ‰é’® === */
    .fab-add {
        position: fixed; bottom: 40px; right: 30px;
        width: 65px; height: 65px;
        background: #333; /* é»‘è‰²æŒ‰é’®ï¼Œå¯¹æ¯”å¼ºçƒˆ */
        border-radius: 50%; color: white; font-size: 36px; border: none;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 100;
        transition: transform 0.2s;
    }
    .fab-add:active { transform: scale(0.9); }

    /* === å¼¹çª—è®¾è®¡ === */
    .modal {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(255, 255, 255, 0.8); /* æµ…è‰²è’™å±‚ */
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        z-index: 200; display: none; justify-content: center; align-items: center;
    }
    .modal-content {
        background: white;
        box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        width: 80%; max-width: 350px; padding: 30px; border-radius: 30px;
    }
    .modal h3 { margin-top: 0; color: #333; font-size: 22px; text-align: center; margin-bottom: 25px;}

    .input-wrapper { position: relative; margin-bottom: 15px; }
    .input-field {
        width: 100%; padding: 15px; padding-right: 45px;
        background: #f7f8fa; border: 1px solid #eee;
        color: #333; border-radius: 15px; box-sizing: border-box; font-size: 16px;
        transition: 0.3s; outline: none;
    }
    .input-field:focus { background: white; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }

    .btn-ocr-icon {
        position: absolute; right: 8px; top: 8px;
        width: 34px; height: 34px; border-radius: 10px;
        background: #eef1f5; border: none; font-size: 18px; color: #555;
        display: flex; align-items: center; justify-content: center; cursor: pointer;
    }

    .modal-btns { display: flex; gap: 15px; margin-top: 30px; }
    .btn-main {
        flex: 1; padding: 15px; border-radius: 15px; border: none; font-weight: bold; font-size: 16px;
        background: #333; color: white;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .btn-sub {
        flex: 1; padding: 15px; border-radius: 15px; border: none;
        background: #f0f2f5; color: #666; font-weight: bold;
    }

    /* OCR åŠ è½½ */
    #loading-mask {
        position: absolute; top:0; left:0; width:100%; height:100%;
        background: rgba(255,255,255,0.9); border-radius: 30px;
        display: none; flex-direction:column; justify-content:center; align-items:center; z-index: 300;
    }
    #ocr-file-input { display: none; }
</style>
</head>
<body>

<input type="file" id="ocr-file-input" accept="image/*">

<!-- 1. ç™»å½•å±‚ -->
<div id="login-layer">
    <div class="lock-emoji">ğŸ”</div>
    <div class="pin-title">æ¬¢è¿å›æ¥ï¼Œè¯·è¾“å…¥å¯†ç </div>
    <input type="tel" id="pin-input" class="pin-input" maxlength="6" placeholder="â€¢ â€¢ â€¢ â€¢ â€¢ â€¢">
    <button class="btn-unlock" onclick="checkPin()">è¿›å…¥å¡åŒ…</button>
</div>

<!-- 2. ä¸»åº”ç”¨å±‚ -->
<div id="app-layer">
    <div class="main-title">
        <span>æˆ‘çš„å¯†ç å¡åŒ…</span>
        <span style="font-size:14px; color:#999; font-weight:normal;">å®‰å…¨å­˜å‚¨</span>
    </div>
    <div id="card-list"></div>
</div>

<button class="fab-add" onclick="showModal()">+</button>

<!-- 3. æ·»åŠ /OCR å¼¹çª— -->
<div id="modal-add" class="modal">
    <div class="modal-content">
        <!-- OCR åŠ è½½çŠ¶æ€ -->
        <div id="loading-mask">
            <div style="font-size:30px; animation:bounce 1s infinite">ğŸ“·</div>
            <div id="loading-text" style="color:#666; margin-top:15px; font-size:14px;">æ­£åœ¨è¯†åˆ«æ–‡å­—...</div>
        </div>

        <h3>æ·»åŠ æ–°å¡ç‰‡</h3>
        
        <div class="input-wrapper">
            <input type="text" id="in-title" class="input-field" placeholder="åç§° (å¦‚: å¾®ä¿¡)">
        </div>

        <div class="input-wrapper">
            <input type="text" id="in-acc" class="input-field" placeholder="è´¦å·">
            <button class="btn-ocr-icon" onclick="startOCR('in-acc')">ğŸ“·</button>
        </div>

        <div class="input-wrapper">
            <input type="text" id="in-pwd" class="input-field" placeholder="å¯†ç ">
            <button class="btn-ocr-icon" onclick="startOCR('in-pwd')">ğŸ“·</button>
        </div>

        <div class="modal-btns">
            <button class="btn-sub" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="btn-main" onclick="saveNewItem()">ä¿å­˜</button>
        </div>
    </div>
</div>

<script>
    const STORE_KEY = 'colorful_vault_data'; // æ•°æ®åº“åæ¢ä¸€ä¸‹ï¼Œé˜²æ­¢å’Œä¹‹å‰çš„å†²çª
    const PIN_KEY = 'colorful_vault_pin';
    let userPin = localStorage.getItem(PIN_KEY);
    // å°è¯•è¯»å–æ—§æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆå§‹åŒ–ä¸ºç©º
    let oldData = localStorage.getItem('cyber_vault_data') || localStorage.getItem('vault_ocr_v1');
    let vaultData = JSON.parse(localStorage.getItem(STORE_KEY)) || (oldData ? JSON.parse(oldData) : []);
    
    let currentTargetInputId = '';

    window.onload = function() {
        if (!userPin) document.querySelector('.pin-title').innerText = "é¦–æ¬¡ä½¿ç”¨ï¼Œè¯·è®¾ç½®å¯†ç ";
    }

    /* === 1. ç™»å½•é€»è¾‘ === */
    function checkPin() {
        const input = document.getElementById('pin-input').value;
        if (!input) return;
        if (!userPin) {
            userPin = input;
            localStorage.setItem(PIN_KEY, userPin);
            alert("å¯†ç è®¾ç½®æˆåŠŸï¼");
            unlockApp();
        } else {
            if (input === userPin) unlockApp();
            else { 
                alert("å¯†ç é”™è¯¯");
                document.getElementById('pin-input').value = '';
            }
        }
    }

    function unlockApp() {
        document.getElementById('login-layer').style.display = 'none';
        document.getElementById('app-layer').style.display = 'block';
        renderList();
    }

    /* === 2. æ ¸å¿ƒï¼šå¤šå½©åˆ—è¡¨æ¸²æŸ“ === */
    function renderList() {
        const container = document.getElementById('card-list');
        container.innerHTML = '';
        vaultData.forEach((item, index) => {
            // è®¡ç®—é¢œè‰²ä¸»é¢˜ï¼š0,1,2,3 å¾ªç¯
            const themeIndex = (index % 4) + 1;
            // è·å–åç§°é¦–å­—æ¯
            const firstLetter = item.title ? item.title[0].toUpperCase() : '#';

            const card = document.createElement('div');
            card.className = `card theme-${themeIndex}`;
            
            // æ·»åŠ è£…é¥°æ°”æ³¡ (éšæœºä½ç½®)
            const bubble1Top = Math.random() * 80;
            const bubble1Left = Math.random() * 80;
            const bubbleSize = Math.random() * 30 + 10;
            
            card.innerHTML = `
                <div class="bubble" style="top:${bubble1Top}%; left:${bubble1Left}%; width:${bubbleSize}px; height:${bubbleSize}px;"></div>
                
                <div class="card-header">
                    <div style="display:flex; align-items:center;">
                        <div class="card-icon">${firstLetter}</div>
                        <div class="card-name">${item.title}</div>
                    </div>
                    <button class="btn-delete" onclick="deleteItem(${index})">âœ•</button>
                </div>

                <div class="card-content-box">
                    <div class="info-item">
                        <div class="info-label">è´¦å·</div>
                        <div class="info-value-row">
                            <div class="info-value" onclick="copyText('${item.acc}')">${item.acc}</div>
                            <button class="capsule-btn" onclick="copyText('${item.acc}')">å¤åˆ¶</button>
                        </div>
                    </div>
                    <div class="info-item" style="margin-bottom:0;">
                        <div class="info-label">å¯†ç </div>
                        <div class="info-value-row">
                            <div class="info-value" id="pwd-txt-${index}" onclick="copyText('${item.pwd}')">â€¢â€¢â€¢â€¢â€¢â€¢</div>
                            <div>
                                <button class="capsule-btn" style="margin-right:5px;" onclick="togglePwd(${index}, '${item.pwd}')">æ˜¾ç¤º</button>
                                <button class="capsule-btn" onclick="copyText('${item.pwd}')">å¤åˆ¶</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    /* === 3. OCR é€»è¾‘ === */
    function startOCR(inputId) {
        currentTargetInputId = inputId;
        document.getElementById('ocr-file-input').click();
    }

    document.getElementById('ocr-file-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        document.getElementById('loading-mask').style.display = 'flex';
        document.getElementById('loading-text').innerText = 'æ­£åœ¨åŠ è½½å¼•æ“...';

        Tesseract.recognize(
            file,
            'eng+chi_sim', 
            {
                logger: m => {
                    if(m.status === 'recognizing text') {
                        document.getElementById('loading-text').innerText = `è¯†åˆ«ä¸­: ${(m.progress * 100).toFixed(0)}%`;
                    }
                }
            }
        ).then(({ data: { text } }) => {
            document.getElementById('loading-mask').style.display = 'none';
            const cleanText = text.replace(/\s+/g, '');
            if(currentTargetInputId) {
                document.getElementById(currentTargetInputId).value = cleanText;
            }
            document.getElementById('ocr-file-input').value = '';
        }).catch(err => {
            document.getElementById('loading-mask').style.display = 'none';
            alert("è¯†åˆ«å¤±è´¥: " + err);
        });
    });

    /* === 4. åŠŸèƒ½å‡½æ•° === */
    function showModal() { document.getElementById('modal-add').style.display = 'flex'; }
    function closeModal() { document.getElementById('modal-add').style.display = 'none'; }

    function saveNewItem() {
        const title = document.getElementById('in-title').value;
        const acc = document.getElementById('in-acc').value;
        const pwd = document.getElementById('in-pwd').value;
        
        if (!title) return alert("è¯·è¾“å…¥åç§°");

        vaultData.unshift({ title, acc, pwd });
        localStorage.setItem(STORE_KEY, JSON.stringify(vaultData));
        
        document.getElementById('in-title').value = '';
        document.getElementById('in-acc').value = '';
        document.getElementById('in-pwd').value = '';
        closeModal();
        renderList();
    }

    function deleteItem(index) {
        if(confirm("ç¡®å®šåˆ é™¤è¿™ä¸ªå¡ç‰‡å—ï¼Ÿ")) {
            vaultData.splice(index, 1);
            localStorage.setItem(STORE_KEY, JSON.stringify(vaultData));
            renderList();
        }
    }
    
    function copyText(text) {
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        alert("å·²å¤åˆ¶ï¼");
    }

    function togglePwd(index, realPwd) {
        const valDiv = document.getElementById(`pwd-txt-${index}`);
        if(valDiv.innerText.includes('â€¢')) {
            valDiv.innerText = realPwd;
        } else {
            valDiv.innerText = 'â€¢â€¢â€¢â€¢â€¢â€¢';
        }
    }
</script>
</body>
</html>